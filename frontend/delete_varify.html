<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원탈퇴 - 본인 확인</title>
    <style>
        body { font-family: "Noto Sans KR", sans-serif; padding: 40px; }
        h1 { margin-bottom: 20px; }
        input {
            display: block;
            margin-bottom: 12px;
            padding: 8px;
            width: 230px;
        }
        button {
            padding: 8px 16px;
            border: 1px solid #333;
            background: white;
            cursor: pointer;
            border-radius: 6px;
        }
    </style>
</head>
<body>

<h1>회원탈퇴 - 비밀번호 확인</h1>

<p><strong>아이디:</strong> <span id="userId"></span></p>

<form id="verifyForm">
    <input type="password" name="currentPassword" placeholder="현재 비밀번호 입력" required>
    <button type="submit">확인</button>
</form>

<script>
    const userId = localStorage.getItem("loginUser");

    if (!userId) {
        alert("로그인이 필요합니다.");
        window.location.href = "login.html";
    }

    document.getElementById("userId").textContent = userId;

    document.getElementById("verifyForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);

        try {
            const res = await fetch(`http://localhost:8080/members/${userId}/verify`, {
                method: "POST",
                body: formData
            });

            const text = await res.text();

            if (!res.ok) {
                alert(text);
                return;
            }

            const confirmDelete = confirm("정말 탈퇴하시겠습니까?");
            if (!confirmDelete) {
                alert("탈퇴가 취소되었습니다.");
                return;
            }

            const deleteRes = await fetch(`http://localhost:8080/members/${userId}/delete`, {
                method: "POST"
            });

            const deleteText = await deleteRes.text();

            if (!deleteRes.ok) {
                alert(deleteText);
                return;
            }

            alert("회원 탈퇴가 완료되었습니다.");

            localStorage.removeItem("loginUser");
            localStorage.removeItem("nickName");

            window.location.href = "index.html";

        } catch (err) {
            alert("에러 발생: " + err);
        }
    });
</script>

</body>
</html>