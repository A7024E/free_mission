<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원 탈퇴 - 본인 확인</title>
</head>
<body>

<h2>본인 확인</h2>

<form id="verifyForm">
    <input name="password" type="password" placeholder="비밀번호 입력" required><br><br>
    <button type="submit">확인</button>
</form>

<script>
    const userId = localStorage.getItem("loginUser");

    if (!userId) {
        alert("로그인이 필요합니다.");
        window.location.href = "login.html";
    }

    document.getElementById("verifyForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);

        // 1) 비밀번호 검증
        const verifyRes = await fetch(`http://localhost:8080/members/${userId}/verify`, {
            method: "POST",
            body: fd
        });

        const verifyMsg = await verifyRes.text();

        if (!verifyRes.ok) {
            alert(verifyMsg); // 비밀번호 틀림
            return;
        }

        // 2) 탈퇴 요청 진행
        const deleteRes = await fetch(`http://localhost:8080/members/${userId}/delete`, {
            method: "POST",
            body: fd // 여기서는 비밀번호 필요없어도 FormData 유지 OK
        });

        const deleteMsg = await deleteRes.text();

        if (!deleteRes.ok) {
            alert(deleteMsg);
            return;
        }

        // 성공 시
        alert("회원 탈퇴가 완료되었습니다.");

        // 로그인 정보 삭제
        localStorage.removeItem("loginUser");

        // index로 이동
        window.location.href = "index.html";
    });
</script>

</body>
</html>